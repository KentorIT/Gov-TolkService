@model Tolk.Web.Models.RequisitionModel
@using Tolk.Web.Services
@{
    ViewData["Title"] = "Registrera rekvisition";
}
<div class="row">
    <div class="col-sm-12">
        <h2>@ViewData["Title"]</h2>
        <form method="post">
            <div class="row">
                <div class="col-sm-4">
                    <display-entry asp-for="OrderNumber" />
                </div>
                <div class="col-sm-4">
                    <display-entry asp-for="OrderCreatedBy" />
                </div>
                <div class="col-sm-4">
                    <display-entry asp-for="CustomerCompactInfo" />
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    <display-entry asp-for="LanguageName" />
                </div>
                <div class="col-sm-4">
                    <display-entry asp-for="RegionName" />
                </div>
                <div class="col-sm-4">
                    <display-entry asp-for="BrokerName" />
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    <display-entry asp-for="Interpreter" />
                </div>
                <div class="col-sm-4">
                    <display-entry asp-for="InterpreterCompetenceLevel" />
                </div>
                <div class="col-sm-4">
                    <input asp-for="RequestId" type="hidden" />
                    <input asp-for="CombinedMaxSizeAttachments" type="hidden" />
                    <input asp-for="FileGroupKey" type="hidden" />
                    <form-entry asp-for="InterpreterTaxCard" type="select" asp-items="SelectListService.TaxCards" class="allow-clear" />
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    @if (Model.RequestPriceInformationModel != null)
                    {
                        await Html.RenderPartialAsync("_PriceInformationDisplay", Model.RequestPriceInformationModel);
                    }
                </div>
                <div class="col-sm-6">
                    @if (Model.PreviousRequisition != null && Model.PreviousRequisition.ResultPriceInformationModel != null)
                    {
                        await Html.RenderPartialAsync("_PriceInformationDisplay", Model.PreviousRequisition.ResultPriceInformationModel);
                    }
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    @if (Model.PreviousRequisition != null)
                    {
                        <a href="@Url.Action("View", "Requisition", new { id = Model.PreviousRequisition.RequisitionId })">Se tidigare rekvisition</a><br /><br />
                    }
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="row">
                        <div class="col-sm-6">
                            <display-entry asp-for="ExpectedStartedAt" />
                        </div>
                        <div class="col-sm-6">
                            @if (Model.PreviousRequisition != null)
                            {
                                <display-entry asp-for="PreviousRequisition.SessionStartedAt" />
                            }
                        </div>
                        <div class="col-sm-12">
                            <form-entry asp-for="SessionStartedAt" id="SessionStartedAt" />
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="row">
                        <div class="col-sm-6">
                            <display-entry asp-for="ExpectedEndedAt" />
                        </div>
                        <div class="col-sm-6">
                            @if (Model.PreviousRequisition != null)
                            {
                                <display-entry asp-for="PreviousRequisition.SessionEndedAt" />
                            }
                        </div>
                        <div class="col-sm-12">
                            <form-entry asp-for="SessionEndedAt" id="SessionEndedAt" />
                            <div id="sessionEndedAtValidator" class="d-none text-danger body"></div>
                            <br /><br />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <form-entry asp-for="TimeWasteTotalTime" />
                    @if (Model.PreviousRequisition != null)
                    {
                        <display-entry asp-for="PreviousRequisition.TimeWasteInfo" label-override="Tidigare angiven tidsspillan" />
                    }
                    <div id="wasteTimeValidator" class="d-none text-danger body"></div>
                    <br />
                </div>
                <div class="test-class col-sm-6">
                    <form-entry asp-for="TimeWasteIWHTime" />
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <h3 class="no-padding-margin">Måltidspauser <span class="form-entry-information glyphicon glyphicon-info-sign" title="Här ska eventuella måltidspauser anges. Klicka på +-ikonen för att lägga till."></span></h3>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <a href="#" class="add-mealbreak-button font-size-14" data-toggle="modal" data-backdrop="static" data-target="#addMealBreak"><span class="glyphicon glyphicon-plus-sign"></span> Lägg till måltidspaus</a>
                    <br /><br />
                    <div class="d-none mealbreak-list no-padding">
                        <table class="table mealbreak-table">
                            <thead><tr><th>Start</th><th>Slut</th><th>Ta bort</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12">
                    <h3 class="no-padding-margin">Resekostnader <span class="form-entry-information glyphicon glyphicon-info-sign" title="Här ska utlägg, traktamente och bilersättning anges."></span></h3>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    @if (Model.ExpectedTravelCosts > 0)
                    {
                        <display-entry asp-for="ExpectedTravelCosts" />}
                    else
                    {
                        <label>Förväntad resekostnad (exkl. moms) i SEK</label>
                        <div class="no-value-info">Inget angivet</div>
                    }
                </div>
                <div class="col-sm-6">
                    <display-entry asp-for="InterpreterLocation" />
                </div>
            </div>
            @if (Model.PreviousRequisition != null)
            {
                <div class="row">
                    <div class="col-sm-4">
                        @if (Model.PreviousRequisition.Outlay != null)
                        {
                            <display-entry asp-for="PreviousRequisition.Outlay" />
                        }
                        else
                        {
                            <label>Tidigare angivet utlägg</label>
                            <div class="no-value-info">Inget angivet</div>
                        }
                    </div>
                    <div class="col-sm-4">
                        @if (Model.PreviousRequisition.CarCompensation != null)
                        {
                            <display-entry asp-for="PreviousRequisition.CarCompensation" />
                        }
                        else
                        {
                            <label>Tidigare angiven bilersättning</label>
                            <div class="no-value-info">Inget angivet</div>
                        }
                    </div>
                    <div class="col-sm-4">
                        @if (Model.PreviousRequisition.PerDiem != null)
                        {
                            <display-entry asp-for="PreviousRequisition.PerDiem" />
                        }
                        else
                        {
                            <label>Tidigare angivet traktamente</label>
                            <div class="no-value-info">Inget angivet</div>
                        }
                    </div>
                </div>
            }
            <div class="row">
                <div class="col-sm-4">
                    <form-entry asp-for="Outlay" />
                    <br />
                </div>
                <div class="col-sm-4">
                    <form-entry asp-for="CarCompensation" />
                    <br />
                </div>
                <div class="col-sm-4">
                    <form-entry asp-for="PerDiem" />
                    <br />
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <form-entry asp-for="Message" />
                </div>
                <div class="col-sm-6">
                    @await Html.PartialAsync("_FileList", new AttachmentListModel { AllowDelete = true, AllowDownload = true, AllowUpload = true, Files = Model.Files, Description = "Möjlighet att bifoga filer som kan vara relevanta för rekvisitionen", Title = string.Empty })
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <a class="btn btn-large btn-warning pull-left do-not-check-dirty" asp-controller="Home" asp-action="Index">Avbryt <span class="btn-remove-times">&times;</span></a>
                </div>
                <div class="col-sm-6">
                    <button id="create" type="submit" class="btn btn-large btn-default pull-right">Registrera rekvisition</button>
                </div>
            </div>
        </form>
    </div>
    <span id="baseMealBreaks" class="d-none">
        <input asp-for="MealBreaks[0].StartAtTemp" type="hidden" />
        <input asp-for="MealBreaks[0].EndAtTemp" type="hidden" />
    </span>
    <span id="basefile" class="d-none">
        <input asp-for="Files[0].Id" type="hidden" />
    </span>
</div>
@await Html.PartialAsync("_UploadFileDialog")
<div id="addMealBreak" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Lägg till måltidspaus</h4>
            </div>
            <div class="modal-body" id="req">
                <form method="post" asp-action="" class="do-not-check-dirty">
                    <div class="row">
                        <div class="col-sm-12">
                            <form-entry asp-for="MealBreakStartAt" id="MealBreakStartedAt" />
                            <div id="mealBreakEndedAtAtValidator" class="d-none text-danger body"></div>
                            <br /><br />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <form-entry asp-for="MealBreakEndAt" id="MealBreakEndedAt" />
                            <div id="mealBreakEndedAtAtValidator" class="d-none text-danger body"></div>
                            <br /><br />
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning left-md-button do-not-check-dirty" data-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn btn-default right-md-button save-mealbreak">Spara måltidspaus</button>
                    <br /><br />
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <environment include="Development">
        <script src="~/js/Files.js" asp-append-version="true"></script>
        <script src="~/js/Requisition/Create.js" asp-append-version="true"></script>
    </environment>
    <environment exclude="Development">
        <script src="~/js/Files.min.js" asp-append-version="true"></script>
        <script src="~/js/Requisition/Create.min.js" asp-append-version="true"></script>
    </environment>
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
