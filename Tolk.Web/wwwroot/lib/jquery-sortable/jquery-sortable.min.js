!function(n,t,i,r){function v(n,t){var i=Math.max(0,n[0]-t[0],t[0]-n[1]),r=Math.max(0,n[2]-t[1],t[1]-n[3]);return i+r}function y(t,i,r,u){var o=t.length,s=u?"offset":"position",e,f;for(r=r||0;o--;)e=t[o].el?t[o].el:n(t[o]),f=e[s](),f.left+=parseInt(e.css("margin-left"),10),f.top+=parseInt(e.css("margin-top"),10),i[o]=[f.left-r,f.left+e.outerWidth()+r,f.top-r,f.top+e.outerHeight()+r]}function o(n,t){var i=t.offset();return{left:n.left-i.left,top:n.top-i.top}}function p(n,t,i){t=[t.left,t.top];i=i&&[i.left,i.top];for(var u,r=n.length,f=[];r--;)u=n[r],f[r]=[r,v(u,t),i&&v(u,i)];return f.sort(function(n,t){return t[1]-n[1]||t[2]-n[2]||t[0]-n[0]})}function s(t){this.options=n.extend({},u,t);this.containers=[];this.options.rootGroup||(this.scrollProxy=n.proxy(this.scroll,this),this.dragProxy=n.proxy(this.drag,this),this.dropProxy=n.proxy(this.drop,this),this.placeholder=n(this.options.placeholder),t.isValidTarget||(this.options.isValidTarget=r))}function l(t,i){this.el=t;this.options=n.extend({},w,i);this.group=s.get(this.options);this.rootGroup=this.options.rootGroup||this.group;this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var r=this.rootGroup.options.itemPath;this.target=r?this.el.find(r):this.el;this.target.on(c.start,this.handle,n.proxy(this.dragInit,this));this.options.drop&&this.group.containers.push(this)}var w={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},u={afterMove:function(){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(){return!0},onCancel:function(){},onDrag:function(n,t){n.css(t)},onDragStart:function(t,i){t.css({height:t.outerHeight(),width:t.outerWidth()});t.addClass(i.group.options.draggedClass);n("body").addClass(i.group.options.bodyClass)},onDrop:function(t,i){t.removeClass(i.group.options.draggedClass).removeAttr("style");n("body").removeClass(i.group.options.bodyClass)},onMousedown:function(n,t,i){if(!i.target.nodeName.match(/^(input|select|textarea)$/i))return i.preventDefault(),!0},placeholderClass:"placeholder",placeholder:'<li class="placeholder"><\/li>',pullPlaceholder:!0,serialize:function(t,i,r){var u=n.extend({},t.data());return r?[i]:(i[0]&&(u.children=i),delete u.subContainers,delete u.sortable,u)},tolerance:0},f={},a=0,b={left:0,top:0,bottom:0,right:0},c={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},e="subContainers",h;s.get=function(n){return f[n.group]||(n.group===r&&(n.group=a++),f[n.group]=new s(n)),f[n.group]};s.prototype={dragInit:function(t,i){this.$document=n(i.el[0].ownerDocument);var r=n(t.target).closest(this.options.itemSelector);if(r.length){if(this.item=r,this.itemContainer=i,this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,u.onMousedown,t))return;this.setPointer(t);this.toggleListeners("on");this.setupDelayTimer();this.dragInitDone=!0}},drag:function(n){if(!this.dragging){if(!this.distanceMet(n)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,u.onDragStart,n);this.item.before(this.placeholder);this.dragging=!0}this.setPointer(n);this.options.onDrag(this.item,o(this.pointer,this.item.offsetParent()),u.onDrag,n);var i=this.getPointer(n),t=this.sameResultBox,f=this.options.tolerance;(!t||t.top-f>i.top||t.bottom+f<i.top||t.left-f>i.left||t.right+f<i.left)&&(this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=r))},drop:function(n){if(this.toggleListeners("off"),this.dragInitDone=!1,this.dragging){if(this.placeholder.closest("html")[0])this.placeholder.before(this.item).detach();else this.options.onCancel(this.item,this.itemContainer,u.onCancel,n);this.options.onDrop(this.item,this.getContainer(this.item),u.onDrop,n);this.clearDimensions();this.clearOffsetParent();this.lastAppendedItem=this.sameResultBox=r;this.dragging=!1}},searchValidTarget:function(n,t){var i,u,s,h,f,e;for(n||(n=this.relativePointer||this.pointer,t=this.lastRelativePointer||this.lastPointer),i=p(this.getContainerDimensions(),n,t),u=i.length;u--;)if(s=i[u][0],h=i[u][1],(!h||this.options.pullPlaceholder)&&(f=this.containers[s],!f.disabled&&(this.$getOffsetParent()||(e=f.getItemOffsetParent(),n=o(n,e),t=o(t,e)),f.searchValidTarget(n,t))))return!0;this.sameResultBox&&(this.sameResultBox=r)},movePlaceholder:function(n,t,i,r){var u=this.lastAppendedItem;(r||!u||u[0]!==t[0])&&(t[i](this.placeholder),this.lastAppendedItem=t,this.sameResultBox=r,this.options.afterMove(this.placeholder,n,t))},getContainerDimensions:function(){return this.containerDimensions||y(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(n){return n.closest(this.options.containerSelector).data(i)},$getOffsetParent:function(){if(this.offsetParent===r){var n=this.containers.length-1,t=this.containers[n].getItemOffsetParent();if(!this.options.rootGroup)while(n--)if(t[0]!=this.containers[n].getItemOffsetParent()[0]){t=!1;break}this.offsetParent=t}return this.offsetParent},setPointer:function(n){var t=this.getPointer(n),i;this.$getOffsetParent()&&(i=o(t,this.$getOffsetParent()),this.lastRelativePointer=this.relativePointer,this.relativePointer=i);this.lastPointer=this.pointer;this.pointer=t},distanceMet:function(n){var t=this.getPointer(n);return Math.max(Math.abs(this.pointer.left-t.left),Math.abs(this.pointer.top-t.top))>=this.options.distance},getPointer:function(n){var t=n.originalEvent||n.originalEvent.touches&&n.originalEvent.touches[0];return{left:n.pageX||t.pageX,top:n.pageY||t.pageY}},setupDelayTimer:function(){var n=this;this.delayMet=!this.options.delay;this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){n.delayMet=!0},this.options.delay))},scroll:function(){this.clearDimensions();this.clearOffsetParent()},toggleListeners:function(t){var i=this;n.each(["drag","drop","scroll"],function(n,r){i.$document[t](c[r],i[r+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=r},clearDimensions:function(){this.traverse(function(n){n._clearDimensions()})},traverse:function(n){n(this);for(var t=this.containers.length;t--;)this.containers[t].traverse(n)},_clearDimensions:function(){this.containerDimensions=r},_destroy:function(){f[this.options.group]=r}};l.prototype={dragInit:function(n){var t=this.rootGroup;!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(n)&&t.dragInit(n,this)},isValidDrag:function(n){return n.which==1||n.type=="touchstart"&&n.originalEvent.touches.length==1},searchValidTarget:function(n,t){var f=p(this.getItemDimensions(),n,t),i=f.length,r=this.rootGroup,e=!r.options.isValidTarget||r.options.isValidTarget(r.item,this),u,o,s;if(!i&&e)return r.movePlaceholder(this,this.target,"append"),!0;while(i--)if(u=f[i][0],o=f[i][1],!o&&this.hasChildGroup(u)){if(s=this.getContainerGroup(u).searchValidTarget(n,t),s)return!0}else if(e)return this.movePlaceholder(u,n),!0},movePlaceholder:function(t,i){var u=n(this.items[t]),f=this.itemDimensions[t],o="after",s=u.outerWidth(),h=u.outerHeight(),e=u.offset(),r={left:e.left,right:e.left+s,top:e.top,bottom:e.top+h},c,l,a,v;this.options.vertical?(c=(f[2]+f[3])/2,l=i.top<=c,l?(o="before",r.bottom-=h/2):r.top+=h/2):(a=(f[0]+f[1])/2,v=i.left<=a,v?(o="before",r.right-=s/2):r.left+=s/2);this.hasChildGroup(t)&&(r=b);this.rootGroup.movePlaceholder(this,u,o,r)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),y(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var n=this.el;return n.css("position")==="relative"||n.css("position")==="absolute"||n.css("position")==="fixed"?n:n.offsetParent()},hasChildGroup:function(n){return this.options.nested&&this.getContainerGroup(n)},getContainerGroup:function(t){var u=n.data(this.items[t],e),f,o;return u===r&&(f=this.$getChildren(this.items[t],"container"),u=!1,f[0]&&(o=n.extend({},this.options,{rootGroup:this.rootGroup,group:a++}),u=f[i](o).data(i).group),n.data(this.items[t],e,u)),u},$getChildren:function(t,i){var r=this.rootGroup.options,u=r[i+"Path"],f=r[i+"Selector"];return t=n(t),u&&(t=t.find(u)),t.children(f)},_serialize:function(t,i){var r=this,u=i?"item":"container",f=this.$getChildren(t,u).not(this.options.exclude).map(function(){return r._serialize(n(this),!i)}).get();return this.rootGroup.options.serialize(t,f,i)},traverse:function(t){n.each(this.items||[],function(){var i=n.data(this,e);i&&i.traverse(t)});t(this)},_clearDimensions:function(){this.itemDimensions=r},_destroy:function(){var t=this;this.target.off(c.start,this.handle);this.el.removeData(i);this.options.drop&&(this.group.containers=n.grep(this.group.containers,function(n){return n!=t}));n.each(this.items||[],function(){n.removeData(this,e)})}};h={enable:function(){this.traverse(function(n){n.disabled=!1})},disable:function(){this.traverse(function(n){n.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(n){n._clearDimensions()})},destroy:function(){this.traverse(function(n){n._destroy()})}};n.extend(l.prototype,h);n.fn[i]=function(t){var u=Array.prototype.slice.call(arguments,1);return this.map(function(){var f=n(this),e=f.data(i);return e&&h[t]?h[t].apply(e,u)||this:(e||t!==r&&typeof t!="object"||f.data(i,new l(f,t)),this)})}}(jQuery,window,"sortable");