function validateControls(){var n=checkWasteTime(),t=checkSessionEndedAt(),i=checkCarCompensation();n&&t&&i?$("#create").enable():$("#create").disable()}function checkCarCompensation(){var n=$("#CarCompensation").val();return n!=""&&(!(Math.floor(n)==n&&$.isNumeric(n))||n.indexOf(".")>0)?(triggerValidator("Bilersättning får endast innehålla siffror <br ><br >",$("#carCompensationValidator")),!1):n!=""&&(parseInt(n)<0||parseInt(n)>1e4)?(triggerValidator("Kontrollera värdet för bilersättning <br ><br >",$("#carCompensationValidator")),!1):($("#carCompensationValidator").hide(),!0)}function checkWasteTime(){var n=$("#TimeWasteTotalTime").val(),t=$("#TimeWasteIWHTime").val();return n!=""&&(!(Math.floor(n)==n&&$.isNumeric(n))||n.indexOf(".")>0)?(triggerValidator("Spilltid får endast innehålla siffror, ange antal minuter <br ><br >",$("#wasteTimeValidator")),!1):n!=""&&(parseInt(n)<31||parseInt(n)>600)?(triggerValidator("Kontrollera värden för spilltid (ska endast anges om det överstiger 30 min) <br ><br >",$("#wasteTimeValidator")),!1):t!=""&&(!(Math.floor(t)==t&&$.isNumeric(t))||t.indexOf(".")>0)?(triggerValidator("Spilltid för obekväm tid får endast innehålla siffror, ange antal minuter <br ><br >",$("#wasteTimeValidator")),!1):(n=n==""?0:n,parseInt(t)>parseInt(n))?(triggerValidator("Spilltid för obekväm tid kan inte vara större än den totala spilltiden <br ><br >",$("#wasteTimeValidator")),!1):(t=t==""?0:t,parseInt(t)<0)?(triggerValidator("Spilltid för obekväm tid kan inte vara mindre än noll <br ><br >",$("#wasteTimeValidator")),!1):($("#wasteTimeValidator").hide(),!0)}function checkSessionEndedAt(){var n="#sessionEndedAtValidator",i="#sessionStartedAtValidator",t;if($(n).hide(),$(i).hide(),checkSessionEndedAtBeforeNow()){if(!checkSessionEndedAtAfterStart())return triggerValidator("Faktisk sluttid kan inte ske före faktisk starttid",$(n)),!1}else return triggerValidator("Faktisk sluttid kan inte ske efter nutid",$(n)),!1;return(t=checkEachMealBreak(getSessionStartDate(),getSessionEndDate(),!0),t!=="")?(t.includes("slut")?triggerValidator(t,$(n)):(triggerValidator(t,$(i)),$(n).hide()),!1):!0}function checkSessionEndedAtAfterStart(){var n=new Date($("#SessionEndedAt_Date").val()),t=$("#SessionEndedAt_Hour").val(),r=$("#SessionEndedAt_Minute").val(),u=new Date($("#SessionStartedAt_Date").val()),i,f;if(n!==""&&t!==""&&r!=="")if(i=$("#SessionStartedAt_Hour").val(),f=$("#SessionStartedAt_Minute").val(),n.equalsDate(new Date(u))){if(Number(i)>Number(t))return!1;if(Number(t)===Number(i))return Number(f)<Number(r)}else if(n.before(u))return!1;return!0}function checkSessionEndedAtBeforeNow(){var t=new Date($("#SessionEndedAt_Date").val()),i=$("#SessionEndedAt_Hour").val(),u=$("#SessionEndedAt_Minute").val(),n,r;if(t!==""&&i!==""&&u!=="")if(n=new Date($("#now").val()),t.equalsDate(n)){if(r=n.getHours(),r<Number(i))return!1;if(r===Number(i))return n.getMinutes()>Number(u)}else if(t.after(n))return!1;return!0}function triggerValidator(n,t){t.empty();t.append(n);t.show()}function getSessionStartDate(){return getDate($("#SessionStartedAt_Date").val(),$("#SessionStartedAt_Hour").val(),$("#SessionStartedAt_Minute").val())}function getSessionEndDate(){return getDate($("#SessionEndedAt_Date").val(),$("#SessionEndedAt_Hour").val(),$("#SessionEndedAt_Minute").val())}function checkEachMealBreak(n,t,i){var r="",f=$("#mealBreak-tbody"),u=f.find("tr");return u.length===0?r:(u.each(function(){var e=$(this).find(".table-start-column").text().trim(),o=$(this).find(".table-end-column").text().trim(),u=e.substring(0,10)+"T"+e.substring(11,16)+":00",f=o.substring(0,10)+"T"+o.substring(11,16)+":00";if(i){if(new Date(u)<=n){r="Minst en måltidspaus börjar innan eller samtidigt som den faktiska starttiden för uppdraget. Ta bort måltidspausen eller ändra faktisk starttid.";return}if(new Date(f)>=t){r="Minst en måltidspaus slutar efter  eller samtidigt som den faktiska sluttiden för uppdraget. Ta bort måltidspausen eller ändra faktisk sluttid.";return}}else{if(new Date(u)-t==0||new Date(f)-n==0||new Date(u)-n==0||new Date(f)-t==0){r="Denna måltidspaus startar eller slutar precis samtidigt som en tidigare sparad måltidspaus startar eller slutar. Det måste vara mellanrum mellan måltidspauser.";return}if(new Date(u)>n&&new Date(u)<t||new Date(u)<n&&new Date(f)>n){r="Denna måltidspaus överlappar med en tidigare sparad måltidspaus.";return}}}),r)}$("#TimeWasteTotalTime").change(function(){validateControls()});$("#TimeWasteIWHTime").change(function(){validateControls()});$("#CarCompensation").change(function(){validateControls()});$("#SessionEndedAt").change(function(){validateControls()});$("#SessionStartedAt").change(function(){validateControls()});$(window).on("unload",function(){var n=$("#RequestId").val(),t;n>0&&(t=tolkBaseUrl+"Request/DeleteRequestView?requestId="+n,$.ajax({type:"DELETE",url:t,dataType:"json",async:!1}))});$(document).ready(function(){var n=$("#RequestId").val(),t;n>0&&(t=tolkBaseUrl+"Request/AddRequestView?requestId="+n,$.ajax({type:"POST",url:t,dataType:"json"}))});$(function(){function t(n){var o;$("#mealBreakEndedAtAtValidator").empty();$("#mealBreakStartedAtAtValidator").empty();var t=$("#SessionStartedAt_Date").val(),u=$("#SessionEndedAt_Date").val(),i=$("#SessionStartedAt_Hour").val(),r=$("#SessionEndedAt_Hour").val(),f=i==23?0:Number(i)+1,e=r==0?23:Number(r)-1;n.find("#MealBreakStartAt_Minute").val(0).trigger("change");n.find("#MealBreakEndAt_Minute").val(0).trigger("change");t!==""&&u===t?(n.find("#MealBreakStartAt_Date").val(t),n.find("#MealBreakEndAt_Date").val(u),n.find("#MealBreakStartAt_Date").attr("disabled",!0),n.find("#MealBreakEndAt_Date").attr("disabled",!0),r-i>1?(n.find("#MealBreakStartAt_Hour").val(f).trigger("change"),n.find("#MealBreakEndAt_Hour").val(e).trigger("change")):(n.find("#MealBreakStartAt_Hour").val(i).trigger("change"),n.find("#MealBreakEndAt_Hour").val(r).trigger("change"))):(n.find("#MealBreakStartAt_Date").val(t),n.find("#MealBreakEndAt_Date").val(t),n.find("#MealBreakStartAt_Hour").val(f).trigger("change"),n.find("#MealBreakEndAt_Hour").val(e).trigger("change"),n.find("#MealBreakStartAt_Date").attr("disabled",!1),n.find("#MealBreakEndAt_Date").attr("disabled",!1));o=n.find("form:first");n.bindEnterKey("form:first input",".btn-default");o.find(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error").html("")}var n=0;$("#create").closest("form").on("submit",function(){disableOnSubmit("#create")});$("body").on("click",".add-mealbreak-button",function(){var n=$($(this).data("target"));t(n)});$("body").on("click",".remove-mealbreak-row",function(){var i=$(this).closest("tbody"),t;$(this).closest("tr").remove();t=i.find("tr");n=0;t.length===0?$(".mealbreak-list").addClass("d-none"):t.each(function(){$(this).find("input").each(function(){var t=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(t,n));$(this).prop("name",$(this).prop("name").replace(t,n))});n++});validateControls()});$("body").on("click",".save-mealbreak",function(t){var f,i,e;t.preventDefault();$("#mealBreakEndedAtAtValidator").empty();$("#mealBreakStartedAtAtValidator").empty();var c=$(this).parents(".modal-content"),o=getSessionStartDate(),s=getSessionEndDate(),r=getDate($("#MealBreakStartAt_Date").val(),$("#MealBreakStartAt_Hour").val(),$("#MealBreakStartAt_Minute").val()),u=getDate($("#MealBreakEndAt_Date").val(),$("#MealBreakEndAt_Hour").val(),$("#MealBreakEndAt_Minute").val());if(r-u==0){triggerValidator("Sluttid kan inte vara samma som starttid",$("#mealBreakEndedAtAtValidator"));return}if(r>u){triggerValidator("Sluttid kan inte vara före starttid",$("#mealBreakEndedAtAtValidator"));return}if(o-r==0){triggerValidator("Måltidspausen kan inte starta samtidigt som uppdraget startar",$("#mealBreakStartedAtAtValidator"));return}if(s-u==0){triggerValidator("Måltidspausen kan inte sluta samtidigt som uppdraget slutar",$("#mealBreakEndedAtAtValidator"));return}if(o>r){triggerValidator("Måltidspausen kan inte starta innan uppdraget startar",$("#mealBreakStartedAtAtValidator"));return}if(s<u){triggerValidator("Måltidspausen kan inte sluta efter uppdraget slutar",$("#mealBreakEndedAtAtValidator"));return}if(f=checkEachMealBreak(r,u,!1),f!==""){triggerValidator(f,$("#mealBreakEndedAtAtValidator"));return}if(c.find("form").valid()){i=$("#baseMealBreaks").clone();i.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",n));$(this).prop("name",$(this).prop("name").replace("0",n))});var l=$("#MealBreakStartAt_Date").val()+" "+getTimeString($("#MealBreakStartAt_Hour").val())+":"+getTimeString($("#MealBreakStartAt_Minute").val()),a=$("#MealBreakEndAt_Date").val()+" "+getTimeString($("#MealBreakEndAt_Hour").val())+":"+getTimeString($("#MealBreakEndAt_Minute").val()),h="#MealBreaks_"+n+"__StartAtTemp";i.find(h).val(l);e="#MealBreaks_"+n+"__EndAtTemp";i.find(e).val(a);$(".mealbreak-table > tbody:last-child").append('<tr><td class="table-start-column">'+i.html()+i.find(h).val()+'<\/td><td class="table-end-column">'+i.find(e).val()+'<\/td><td class="table-remove-column"><span class="remove-mealbreak-row bold">&times;<\/span><\/td><\/tr>');n++;$(".mealbreak-list").removeClass("d-none");$("#addMealBreak").modal("hide")}});n=$(".mealbreak-table > tbody > tr").length});