var LastAnswerByIsShowing=!1;$(function(){function l(n){var t=$("#LanguageId option:selected").attr("data-additional"),i=!1,r=$("input[name = CompetenceLevelDesireType]").filter("input:checked");$(r[0]).val()==="Requirement"&&t.length!==4&&n.each(function(){switch($(this).val()){case"CourtSpecialist":t.indexOf("L")>=0||(i=!0);break;case"HealthCareSpecialist":t.indexOf("H")>=0||(i=!0);break;case"AuthorizedInterpreter":t.indexOf("A")>=0||(i=!0);break;case"EducatedInterpreter":t.indexOf("E")>=0||(i=!0)}});i?$("#competence-not-available").show():$("#competence-not-available").hide()}function p(n){n.find("#RequirementDescription").val("");var t=n.find("form:first");n.bindEnterKey("form:first input",".btn-default");t.find(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error").html("")}function u(n,t){var i='[data-valmsg-for="'+n+'"]';$(i).empty();$(i).append(t);$(i).show()}var i=0,r=0,n=0,h=!1,c=!0,w='<div class="pull-right"><a class="btn btn-warning table-button change">Ändra <span class="glyphicon glyphicon-edit"><\/span><\/a>&nbsp;<a class="btn btn-danger table-button remove">Ta bort <span class="glyphicon glyphicon-remove"><\/span><\/a><\/div>',f=$("#req").parents(".modal-content"),e=$("#des").parents(".modal-content"),b=function(n){n.attr("value")===$("#OtherLanguageId").val()?$("#other-language").collapse("show"):$("#other-language").collapse("hide");n.attr("data-additional")===""?($(".competence-information > span.info-message-small").text("").removeAttr("role"),$("#divNonCompetenceLevel").show(),$("#divNonCompetenceLevel2").show(),$("#divCompetenceLevel").hide(),$("#LanguageHasAuthorizedInterpreter").val("false"),$(".competence-information").removeClass("d-none"),$(".competence-information").addClass("d-none"),$("#competence-not-available").hide()):(k(n.attr("data-additional")),$("#divNonCompetenceLevel").hide(),$("#divNonCompetenceLevel2").hide(),$("#divCompetenceLevel").show(),$("#LanguageHasAuthorizedInterpreter").val("true"),l($('[data-checkbox-group="RequiredCompetenceLevels"]').filter(":checked")))},k=function(n){$(".competence-information").removeClass("d-none");$(".competence-information > div.comp-list").find("li").remove();$(".competence-information > div.comp-list").find("ul").remove();n.length===4?($(".competence-information").removeClass("warning-info-home").removeClass("warning-info-yellow").addClass("system-action-info").children("span.glyphicon.message-icon").removeClass("glyphicon-exclamation-sign").addClass("glyphicon-ok").removeClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Kammarkollegiets tolkregister har tolkar för samtliga kompetensnivåer för valt språk").attr("role","status")):n==="0"?($(".competence-information").removeClass("warning-info-yellow").removeClass("system-action-info").addClass("warning-info-home").children("span.glyphicon.message-icon").removeClass("glyphicon-ok").addClass("glyphicon-exclamation-sign").removeClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Kammarkollegiets tolkregister har inga tolkar för någon kompetensnivå för valt språk").attr("role","alert")):($(".competence-information").removeClass("warning-info-home").removeClass("system-action-info").addClass("warning-info-yellow").children("span.glyphicon.message-icon").removeClass("glyphicon-ok").addClass("glyphicon-exclamation-sign").addClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Tolkar med följande kompetensnivå finns i Kammarkollegiets tolkregister för valt språk:").attr("role","alert"),$(".competence-information > div.comp-list").append("<ul>"),n.indexOf("L")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Rättstolk<\/li>"),n.indexOf("H")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Sjukvårdstolk<\/li>"),n.indexOf("A")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Auktoriserad tolk<\/li>"),n.indexOf("E")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Utbildad tolk<\/li>"),$(".competence-information > div.comp-list").append("<\/ul>"))},o=function(n,t,i){n.val()==="Gender"?(t.show(),i.hide()):(t.hide(),i.show(),i.find("input").val(""))},v=function(){var e,i,o,u,r,s;if(!c){alert("Det går inte att lägga till tillfällen för nära i tiden när man vill beställa flera tillfällen.");return}var h=$(".order-datepicker").closest("form"),l=h.validate(),f=!0;($(".order-datepicker input, .order-datepicker select").each(function(n,t){f=l.element(t)&&f}),f)&&(e=$("#ExtraInterpreter").is(":checked")?"Ja":"Nej",i=$("#baseOccasion").clone(),i.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",n));$(this).prop("name",$(this).prop("name").replace("0",n))}),n++,o=$("#SplitTimeRange_StartDate").val()+" "+t($("#SplitTimeRange_StartTimeHour").val())+":"+t($("#SplitTimeRange_StartTimeMinutes").val())+"-"+t($("#SplitTimeRange_EndTimeHour").val())+":"+t($("#SplitTimeRange_EndTimeMinutes").val()),u=new Date($("#SplitTimeRange_StartDate").val()),u.setHours($("#SplitTimeRange_StartTimeHour").val()),u.setMinutes($("#SplitTimeRange_StartTimeMinutes").val()),i.find("input[name$='OccasionStartDateTime']").val($("#SplitTimeRange_StartDate").val()+" "+t($("#SplitTimeRange_StartTimeHour").val())+":"+t($("#SplitTimeRange_StartTimeMinutes").val())),r=new Date($("#SplitTimeRange_StartDate").val()),r.setHours($("#SplitTimeRange_EndTimeHour").val()),r.setMinutes($("#SplitTimeRange_EndTimeMinutes").val()),r<=u&&r.addDays(1),i.find("input[name$='OccasionEndDateTime']").val(r.toLocaleDateString("sv-SE").replace(/&lrm;|\u200E/gi,"")+" "+t($("#SplitTimeRange_EndTimeHour").val())+":"+t($("#SplitTimeRange_EndTimeMinutes").val())),i.find("input[name$='ExtraInterpreter']").val($("#ExtraInterpreter").is(":checked")?"true":"false"),s=$(".several-occasions-table table").DataTable(),s.row.add([o+i.html(),e,w]).draw(),$(".order-datepicker input:text").val(""),$(".order-datepicker select").each(function(){$(this).val("").trigger("change")}),$("#ExtraInterpreter").prop("checked",!1))},t=function(n){return n<10?"0"+n:""+n},d=function(){var n=new Date($("#now").val());h=!(n.getHours()===13||n.getHours()===23)},s=function(){if(!$("#SeveralOccasions").is(":checked")){var n=LastAnswerByIsShowing||!y();$("#SeveralOccasions").prop("disabled",n);n?$("#SeveralOccasions").parents(".checkbox").addClass("checkbox-disabled"):$("#SeveralOccasions").parents(".checkbox").removeClass("checkbox-disabled")}},y=function(){return!($("#SplitTimeRange_StartDate").val()===""||$("#SplitTimeRange_StartTimeHour").val()===""||$("#SplitTimeRange_StartTimeMinutes").val()===""||$("#SplitTimeRange_EndTimeHour").val()===""||$("#SplitTimeRange_EndTimeMinutes").val()==="")},a;$("body").on("click",".remove-requirement-row",function(){var t=$(this).closest("tbody"),n;$(this).closest("tr").remove();n=t.find("tr");i=0;n.length===0?$(".order-requirement-list").addClass("d-none"):n.each(function(){$(this).find("input").each(function(){var n=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(n,i));$(this).prop("name",$(this).prop("name").replace(n,i))});i++})});$("body").on("click",".remove-desiredRequirement-row",function(){var t=$(this).closest("tbody"),n;$(this).closest("tr").remove();n=t.find("tr");r=0;n.length===0?$(".order-desiredRequirement-list").addClass("d-none"):n.each(function(){$(this).find("input").each(function(){var n=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(n,r));$(this).prop("name",$(this).prop("name").replace(n,r))});r++})});$("body").on("click",".add-requirement-button",function(){var n=$($(this).data("target"));p(n);o(n.find("#RequirementType"),n.find("input[name$=Gender]").parents(".form-group"),n.find("#RequirementDescription").parents(".form-group"))});$("body").on("click",".add-desiredRequirement-button",function(){var n=$($(this).data("target"));p(n);o(n.find("#DesiredRequirementType"),n.find("input[name$=DesiredGender]").parents(".form-group"),n.find("#DesiredRequirementDescription").parents(".form-group"))});$("body").on("click",".save-requirement",function(n){var t,u,r;n.preventDefault();t=$(this).parents(".modal-content");t.find("#RequirementType option:selected").text()==="Tolkens kön"&&(u=t.find("input[type='Radio']").filter(":checked").val()==="Female"?"Kvinna":"Man",t.find("#RequirementDescription").val(u));t.find("form").valid()&&(r=$("#baseRequirement").clone(),r.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",i));$(this).prop("name",$(this).prop("name").replace("0",i))}),i++,t.find("input:not(:checkbox), select, textarea").each(function(){r.find("input[name$='"+$(this).prop("id")+"']").val($(this).val())}),t.find("input:checkbox").each(function(){r.find("input[name$='"+$(this).prop("id")+"']").val($(this).is(":checked")?"true":"false")}),$(".order-requirement-table > tbody:last-child").append('<tr><td class="table-type-column">'+r.html()+$("#RequirementType option:selected").text()+'<\/td><td class="table-description-column">'+$("#RequirementDescription").val()+'<\/td><td class="table-button-column fixed"><span class="remove-requirement-row bold">&times;<\/span><\/td><\/tr>'),$(".order-requirement-list").removeClass("d-none"),$("#addRequirement").modal("hide"))});$("body").on("click",".save-desiredRequirement",function(n){var t,u,i;n.preventDefault();t=$(this).parents(".modal-content");t.find("#DesiredRequirementType option:selected").text()==="Tolkens kön"&&(u=t.find("input[type='Radio']").filter(":checked").val()==="Female"?"Kvinna":"Man",t.find("#DesiredRequirementDescription").val(u));t.find("form").valid()&&(i=$("#baseDesiredRequirement").clone(),i.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",r));$(this).prop("name",$(this).prop("name").replace("0",r))}),r++,t.find("input:not(:checkbox), select, textarea").each(function(){i.find("input[name$='"+$(this).prop("id")+"']").val($(this).val())}),t.find("input:checkbox").each(function(){i.find("input[name$='"+$(this).prop("id")+"']").val($(this).is(":checked")?"true":"false")}),$(".order-desiredRequirement-table > tbody:last-child").append('<tr><td class="table-type-column">'+i.html()+$(this).parents(".modal-content").find("#DesiredRequirementType option:selected").text()+'<\/td><td class="table-description-column">'+$(this).parents(".modal-content").find("#DesiredRequirementDescription").val()+'<\/td><td class="table-button-column fixed"><span class="remove-desiredRequirement-row bold">&times;<\/span><\/td><\/tr>'),$(".order-desiredRequirement-list").removeClass("d-none"),$("#addDesiredRequirement").modal("hide"))});f.find("#RequirementType").on("change",function(){o(f.find("#RequirementType"),f.find("input[name$=Gender]").parents(".form-group"),f.find("#RequirementDescription").parents(".form-group"))});e.find("#DesiredRequirementType").on("change",function(){o(e.find("#DesiredRequirementType"),e.find("input[name$=DesiredGender]").parents(".form-group"),e.find("#DesiredRequirementDescription").parents(".form-group"))});$("body").on("change","#LanguageId",function(){b($("#LanguageId option:selected"))});$("body").on("change","input[name=CompetenceLevelDesireType]",function(){var n=$(this).filter("input:checked");$(n[0]).val()==="Request"?($("#competence-required").hide(),$("#competence-requested").show(),$("#competence-info").show(),$("#competence-not-available").hide(),$("#RequiredCompetenceLevels_cbHidden").addClass("ignore-validation")):$(n[0]).val()==="Requirement"?($("#competence-requested").hide(),$("#competence-required").show(),$("#competence-info").hide(),l($('[data-checkbox-group="RequiredCompetenceLevels"]').filter(":checked")),$("#RequiredCompetenceLevels_cbHidden").removeClass("ignore-validation")):($("#competence-requested").hide(),$("#competence-required").hide(),$("#competence-info").show(),$("#competence-not-available").hide(),$("#RequiredCompetenceLevels_cbHidden").addClass("ignore-validation"))});$("body").on("change","#SplitTimeRange_StartTimeHour",function(){var t=parseInt($(this).val()),i=$("#SplitTimeRange_EndTimeHour").val(),r=$("#SplitTimeRange_StartTimeMinutes").val(),u=$("#SplitTimeRange_EndTimeMinutes").val(),n;i===""&&(n=parseInt($(this).val())===23?0:t+1,$("#SplitTimeRange_EndTimeHour").val(n).trigger("change").trigger("select2:select"));r===""&&$("#SplitTimeRange_StartTimeMinutes").val(0).trigger("change").trigger("select2:select");u===""&&$("#SplitTimeRange_EndTimeMinutes").val(0).trigger("change").trigger("select2:select")});$("body").on("change","#SplitTimeRange_StartTimeHour, #SplitTimeRange_StartTimeMinutes, #SplitTimeRange_EndTimeHour, #SplitTimeRange_EndTimeMinutes",function(){s()});$("body").on("change","#LatestAnswerBy_Hour",function(){$("#LatestAnswerBy_Minute").val()===""&&$("#LatestAnswerBy_Minute").val(0).trigger("change").trigger("select2:select")});$("body").on("change","#SplitTimeRange_StartDate",function(){var n=new Date($("#now").val()),i,t;if(h||n.getHours()!==14&&n.getHours()!==0||($("#LastTimeForRequiringLatestAnswerBy").val($("#NextLastTimeForRequiringLatestAnswerBy").val()),h=!0),i=new Date($("#LastTimeForRequiringLatestAnswerBy").val()),t=new Date($(this).val()),c=!0,t<=i){if($("#SeveralOccasions").is(":checked")){c=!1;return}$("#LatestAnswerBy").show();$("#LatestAnswerBy_Date").datepicker("setStartDate",n.zeroTime());$("#LatestAnswerBy_Date").datepicker("setEndDate",t);LastAnswerByIsShowing=!0}else $("#LatestAnswerBy").hide(),LastAnswerByIsShowing=!1;s()});$("body").on("change",".location-group",function(){var n=!1;$("select[id^=RankedInterpreterLocation]").each(function(){switch($(this).val()){case"OnSite":case"OffSiteDesignatedLocation":n=!0}});n?$(".allow-more-travel-cost").show():$(".allow-more-travel-cost").hide()});$("body").on("click",".wizard-forward-button",function(){document.body.scrollTop=0;document.documentElement.scrollTop=0});$("body").on("change","#RequiredCompetenceLevels",function(){var n=$('[data-checkbox-group="RequiredCompetenceLevels"]'),t=n.filter(":checked");t.length>=2?n.filter(":not(:checked)").attr("disabled","disabled"):n.filter(":not(:checked)").removeAttr("disabled");t.length>0?l(t):$("#competence-not-available").hide()});$("body").on("click","input[name=AllowExceedingTravelCost]",function(){$(this).val()==="YesShouldBeApproved"?($(".allow-more-travel-cost-information").show(),$(".allow-no-review-travel-cost-information").hide()):$(this).val()==="YesShouldNotBeApproved"?($(".allow-more-travel-cost-information").hide(),$(".allow-no-review-travel-cost-information").show()):($(".allow-more-travel-cost-information").hide(),$(".allow-no-review-travel-cost-information").hide())});$("body").on("click","tr > td > div > a.table-button.change",function(){alert("add functionality for taking the info in the row reading into the occasion input above the row...")});$("body").on("click","tr > td > div > a.table-button.remove",function(){var t=$(".several-occasions-table table").DataTable();t.row($(this).parents("tr")).remove().draw();n=0;t.data().any()?$(".several-occasions-table table tbody tr").each(function(){$(this).find("input").each(function(){var t=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(t,n));$(this).prop("name",$(this).prop("name").replace(t,n))});n++}):($("#SeveralOccasions").prop("checked",!1).trigger("change"),s())});$("body").on("change","#SeveralOccasions",function(){if($(this).is(":checked"))$(".several-occasions-table").show(),$(".add-date-button-row").show(),v();else{$(".several-occasions-table").hide();$(".add-date-button-row").hide();var t=$(".several-occasions-table table").DataTable();t.clear().draw();n=0;$("#SplitTimeRange_StartDate").val()!==""&&$("#SplitTimeRange_StartDate").trigger("change");s()}});$("body").on("click",".add-occasion",function(){v()});$(".allow-more-travel-cost").hide();$("input[name=CompetenceLevelDesireType]").trigger("change");$("#UseRankedInterpreterLocation").trigger("change");d();$("#SplitTimeRange_StartDate").trigger("change");$(".allow-no-review-travel-cost-information").hide();$(".allow-more-travel-cost-information").hide();$("#SeveralOccasions").trigger("change");$(".extra-interpreter-part").detach().appendTo(".date-and-time-part");$("#SeveralOccasions").prop("disabled",!0);var g=function(){var n,i;if(!$("#LatestAnswerBy_Date").is(":visible"))return!0;var r=new Date($("#LatestAnswerBy_Date").val()),t=$("#LatestAnswerBy_Hour").val(),u=$("#LatestAnswerBy_Minute").val();if(r!==""&&t!==""&&u!==""&&(n=new Date($("#now").val()),r.equalsDate(n))){if(i=n.getHours(),i>Number(t))return!1;if(i===Number(t))return!(n.getMinutes()>Number(u))}return!0},nt=function(){if(!$("#LatestAnswerBy_Date").is(":visible"))return!0;var t=new Date($("#LatestAnswerBy_Date").val()),n=$("#LatestAnswerBy_Hour").val(),i=$("#LatestAnswerBy_Minute").val();if(t!==""&&n!==""&&i!==""){var u=new Date($("#SplitTimeRange_StartDate").val()),r=$("#SplitTimeRange_StartTimeHour").val(),f=$("#SplitTimeRange_StartTimeMinutes").val();if(t.equalsDate(new Date(u))){if(Number(n)>Number(r))return!1;if(Number(n)===Number(r))return Number(f)>Number(i)}}return!0},tt=function(){var r=new Date($("#SplitTimeRange_StartDate").val()),t=$("#SplitTimeRange_StartTimeHour").val(),u=$("#SplitTimeRange_StartTimeMinutes").val(),n,i;if(r!==""&&t!==""&&u!==""&&(n=new Date($("#now").val()),r.equalsDate(n))){if(i=n.getHours(),i>Number(t))return!1;if(i===Number(t))return!(n.getMinutes()>Number(u))}return!0},it=function(){var n=Number($("#SplitTimeRange_StartTimeHour").val()),t=Number($("#SplitTimeRange_StartTimeMinutes").val()),i=Number($("#SplitTimeRange_EndTimeHour").val()),r=Number($("#SplitTimeRange_EndTimeMinutes").val());return Number(n)===i?r!==Number(t):!0},rt=function(){return $("#CompetenceLevelDesireType").is(":hidden")||$("[name=CompetenceLevelDesireType]").filter(":checked").length>0},ut=function(){if($("#AllowExceedingTravelCost").is(":hidden"))return!0;var n=$("[id^=AllowExceedingTravelCost_]").filter(":checked")[0];return n!==undefined};a=$(".wizard");a.tolkWizard({nextHandler:function(n){var t=0,i,r,f;if($("[data-valmsg-for]").empty(),LastAnswerByIsShowing||($("#LatestAnswerBy_Date").val(""),$("#LatestAnswerBy_Hour").val("").trigger("change"),$("#LatestAnswerBy_Minute").val("").trigger("change")),rt()||(u("CompetenceLevelDesireType","Ange om kompetensnivå är krav eller önskemål"),t++),ut()||(u("AllowExceedingTravelCost","Ange hurvida restid eller resväg som överskriver gränsvärden accepteras"),t++),$("#SeveralOccasions").is(":checked")){if(y()&&!confirm("Det finns ett fullständigt tillfälle som inte är tillagt än. Vill du fortsätta?"))return!1}else tt()||(u("SplitTimeRange.EndTimeMinutes","Uppdraget har en starttid som redan har passerats, var god ändra detta."),t++),it()||(u("SplitTimeRange.EndTimeMinutes","Uppdragets start- och sluttid har samma värde, var god ändra detta."),t++),g()||(u("LatestAnswerBy.Date","Sista svarstid har redan passerats, var god ändra detta."),t++),nt()||(u("LatestAnswerBy.Date","Sista svarstid kan inte vara senare än tolkuppdragets starttid, var god ändra detta."),t++);if(t!==0)return!1;i=a.closest("form");r=n.NextStep;$("#send").attr("disabled","disabled");$("#back").attr("disabled","disabled");n.IsLastPage?i.submit():(f=tolkBaseUrl+"Order/Confirm",$.ajax({url:f,type:"POST",data:i.serialize(),dataType:"html",success:function(n){$(".wizard .wizard-step").eq(r).html(n);$(".form-entry-information").tooltip();$("#send").removeAttr("disabled");$("#back").removeAttr("disabled")},error:function(n){alert(n)}}))},wizardStepRendered:function(){$("#send").append('<span class="center-glyphicon glyphicon glyphicon-triangle-right"><\/span>');$("#send").blur()}});$("body").on("mousedown",".wizard-forward-button",function(){$("#SeveralOccasions").is(":checked")&&$(".order-datepicker input, .order-datepicker select").each(function(){$(this).addClass("ignore-validation")})});$("body").on("click",".wizard-forward-button",function(){$(".order-datepicker input, .order-datepicker select").each(function(){$(this).removeClass("ignore-validation")})})});