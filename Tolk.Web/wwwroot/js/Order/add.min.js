var LastAnswerByIsShowing=!1;$(function(){function k(t,i){var u=new Date($("#now").val());if(u-t==0||u>t)return"Tid och datum för tillfället har redan passerat.";var r="",e=$("#occasion-tbody"),f=e.find("tr");return f.length===1&&n===0?r:(f.each(function(){var n=$(this).find("input[name$='OccasionStartDateTime']").val(),u=$(this).find("input[name$='OccasionEndDateTime']").val();if(new Date(n)-i==0||new Date(u)-t==0||new Date(n)-t==0||new Date(u)-i==0){r="Detta tillfälle startar eller slutar samtidigt som ett tidigare tillagt tillfälle startar eller slutar. Det måste vara mellanrum mellan tillfällena.";return}if(new Date(n)>t&&new Date(n)<i||new Date(n)<t&&new Date(u)>t){r="Detta tillfälle överlappar med ett tidigare tillagt tillfälle.";return}}),r)}function d(){if($("#LanguageId option:selected").data("additional")!==""){var i=$("input[name = CompetenceLevelDesireType]").filter("input:checked"),n=$("#RequestedCompetenceLevelFirst").val(),t=$("#RequestedCompetenceLevelSecond").val();if($(i[0]).val()==="Requirement"){if(n==="")return"Krav i första hand måste anges";if(n===t)return"Krav i första och andra hand kan inte vara samma"}if($(i[0]).val()==="Request"){if(n===""&&n!==t)return"Ange önskemål i första hand om du angett önskemål i andra hand";if(n!==""&&n===t)return"Önskemål i första och andra hand kan inte vara samma"}}return""}function a(){s("CreatorIsInterpreterUser");var n=$("input[name = CreatorIsInterpreterUser]").filter("input:checked");$(n[0]).val()==="No"?$("#CreatorIsNotInterpreterUserInfo").show():$("#CreatorIsNotInterpreterUserInfo").hide()}function o(){var n=$("#LanguageId option:selected").data("additional"),t=!1,i=$("input[name = CompetenceLevelDesireType]").filter("input:checked");$(i[0]).val()==="Requirement"&&n!==0&&n.length!==4&&$("#RequestedCompetenceLevelFirst, #RequestedCompetenceLevelSecond").each(function(){switch($(this).val()){case"CourtSpecialist":n.indexOf("L")>=0||(t=!0);break;case"HealthCareSpecialist":n.indexOf("H")>=0||(t=!0);break;case"AuthorizedInterpreter":n.indexOf("A")>=0||(t=!0);break;case"EducatedInterpreter":n.indexOf("E")>=0||(t=!0)}});t?$("#competence-not-available").show():$("#competence-not-available").hide()}function t(n,t){var i='[data-valmsg-for="'+n+'"]';$(i).empty();$(i).append(t);$(i).show()}function s(n){var t='[data-valmsg-for="'+n+'"]';$(t).hide()}function c(n,t){t.empty();t.append(n);t.show()}var n=0,r=!1,f=!0,v='<div class="pull-right"><a class="btn btn-danger small-button remove">Ta bort <span class="btn-remove-times-small">&times;<\/span><\/a><\/div>',y=function(n){n.attr("value")===$("#OtherLanguageId").val()?$("#other-language").collapse("show"):$("#other-language").collapse("hide");n.data("additional")===""?($(".competence-information > span.info-message-small").text("").removeAttr("role"),$("#divNonCompetenceLevel").show(),$("#divNonCompetenceLevel2").show(),$("#divCompetenceLevel").hide(),$("#LanguageHasAuthorizedInterpreter").val("false"),$(".competence-information").removeClass("d-none"),$(".competence-information").addClass("d-none"),$("#competence-not-available").hide()):(p(n.data("additional")),$("#divNonCompetenceLevel").hide(),$("#divNonCompetenceLevel2").hide(),$("#divCompetenceLevel").show(),$("#LanguageHasAuthorizedInterpreter").val("true"),o())},p=function(n){$(".competence-information").removeClass("d-none");$(".competence-information > div.comp-list").find("li").remove();$(".competence-information > div.comp-list").find("ul").remove();n.length===4?($(".competence-information").removeClass("warning-info-home").removeClass("warning-info-yellow").addClass("system-action-info").children("span.glyphicon.message-icon").removeClass("glyphicon-exclamation-sign").addClass("glyphicon-ok").removeClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Det finns tolkar inom samtliga kompetensnivåer för valt språk i Kammarkollegiets tolkregister").attr("role","status")):n===0?($(".competence-information").removeClass("warning-info-yellow").removeClass("system-action-info").addClass("warning-info-home").children("span.glyphicon.message-icon").removeClass("glyphicon-ok").addClass("glyphicon-exclamation-sign").removeClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Det finns för närvarande inga tolkar som är utbildade eller auktoriserade i valt språk i Kammarkollegiets tolkregister").attr("role","alert")):($(".competence-information").removeClass("warning-info-home").removeClass("system-action-info").addClass("warning-info-yellow").children("span.glyphicon.message-icon").removeClass("glyphicon-ok").addClass("glyphicon-exclamation-sign").addClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Tolkar med följande kompetensnivå finns i Kammarkollegiets tolkregister för valt språk:").attr("role","alert"),$(".competence-information > div.comp-list").append("<ul>"),n.indexOf("L")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Rättstolk<\/li>"),n.indexOf("H")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Sjukvårdstolk<\/li>"),n.indexOf("A")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Auktoriserad tolk<\/li>"),n.indexOf("E")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Utbildad tolk<\/li>"),$(".competence-information > div.comp-list").append("<\/ul>"))},l=function(){var s,u,h,a,o,r,y;if($("#OccasionValidator").empty(),!f){c("Det går inte att lägga till tillfällen för nära i tiden när man vill boka flera tillfällen.",$("#OccasionValidator"));return}if(!e()){c("Fyll i datum och tid",$("#OccasionValidator"));return}if(s=getDate($("#SplitTimeRange_StartDate").val(),$("#SplitTimeRange_StartTimeHour").val(),$("#SplitTimeRange_StartTimeMinutes").val()),u=getDate($("#SplitTimeRange_StartDate").val(),$("#SplitTimeRange_EndTimeHour").val(),$("#SplitTimeRange_EndTimeMinutes").val()),u<s&&u.addDays(1),h=k(s,u),h!==""){c(h,$("#OccasionValidator"));return}var p=$(".order-datepicker").closest("form"),w=p.validate(),l=!0;if($(".order-datepicker input, .order-datepicker select").each(function(n,t){l=w.element(t)&&l}),l){var b=$("#ExtraInterpreter").is(":checked")?"Ja":"Nej",d=$("#MealBreakIncluded").is(":checked")?"Ja":"Nej",t=$("#baseOccasion").clone();t.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",n));$(this).prop("name",$(this).prop("name").replace("0",n))});n++;a=$("#SplitTimeRange_StartDate").val()+" "+i($("#SplitTimeRange_StartTimeHour").val())+":"+i($("#SplitTimeRange_StartTimeMinutes").val())+"-"+i($("#SplitTimeRange_EndTimeHour").val())+":"+i($("#SplitTimeRange_EndTimeMinutes").val());o=new Date($("#SplitTimeRange_StartDate").val());o.setHours($("#SplitTimeRange_StartTimeHour").val());o.setMinutes($("#SplitTimeRange_StartTimeMinutes").val());t.find("input[name$='OccasionStartDateTime']").val($("#SplitTimeRange_StartDate").val()+" "+i($("#SplitTimeRange_StartTimeHour").val())+":"+i($("#SplitTimeRange_StartTimeMinutes").val()));r=new Date($("#SplitTimeRange_StartDate").val());r.setHours($("#SplitTimeRange_EndTimeHour").val());r.setMinutes($("#SplitTimeRange_EndTimeMinutes").val());r<=o&&r.addDays(1);t.find("input[name$='OccasionEndDateTime']").val(r.toLocaleDateString("sv-SE").replace(/&lrm;|\u200E/gi,"")+" "+i($("#SplitTimeRange_EndTimeHour").val())+":"+i($("#SplitTimeRange_EndTimeMinutes").val()));t.find("input[name$='ExtraInterpreter']").val($("#ExtraInterpreter").is(":checked")?"true":"false");t.find("input[name$='MealBreakIncluded']").val($("#MealBreakIncluded").is(":checked")?"true":"false");y=$(".several-occasions-table table").DataTable();y.row.add([a+t.html(),b,d,v]).draw();$(".order-datepicker input:text").val("");$(".order-datepicker select").each(function(){$(this).val("").trigger("change")});$("#ExtraInterpreter").prop("checked",!1);$("#MealBreakIncluded").prop("checked",!1);$("#mealbreak-included").hide()}},i=function(n){return n<10?"0"+n:""+n},w=function(){var n=new Date($("#now").val());r=!(n.getHours()===13)},u=function(){if(!$("#SeveralOccasions").is(":checked")){var n=LastAnswerByIsShowing||!e();$("#SeveralOccasions").prop("disabled",n);n?$("#SeveralOccasions").parents(".checkbox").addClass("checkbox-disabled"):$("#SeveralOccasions").parents(".checkbox").removeClass("checkbox-disabled")}},b=function(){if($("#SplitTimeRange_StartTimeHour").val()!==""&&$("#SplitTimeRange_StartTimeMinutes").val()!==""&&$("#SplitTimeRange_EndTimeHour").val()!==""&&$("#SplitTimeRange_EndTimeMinutes").val()!==""){var n=!1,t=Number($("#SplitTimeRange_StartTimeHour").val()),r=Number($("#SplitTimeRange_StartTimeMinutes").val()),i=Number($("#SplitTimeRange_EndTimeHour").val()),u=Number($("#SplitTimeRange_EndTimeMinutes").val());t===i?n=u<=r:t>i?t-i<20?n=!0:t-i==20&&(n=u>r):i-t>5?n=!0:i-t==5&&(n=u>r);n?$("#mealbreak-included").show():($("#MealBreakIncluded").prop("checked",!1),$("#mealbreak-included").hide())}},e=function(){return!($("#SplitTimeRange_StartDate").val()===""||$("#SplitTimeRange_StartTimeHour").val()===""||$("#SplitTimeRange_StartTimeMinutes").val()===""||$("#SplitTimeRange_EndTimeHour").val()===""||$("#SplitTimeRange_EndTimeMinutes").val()==="")},h;$("body").on("change","#LanguageId",function(){y($("#LanguageId option:selected"))});$("body").on("change","#RequestedCompetenceLevelFirst, #RequestedCompetenceLevelSecond",function(){o()});$("body").on("change","input[name=CompetenceLevelDesireType]",function(){s("CompetenceLevelDesireType");var n=$(this).filter("input:checked");$(n[0]).val()==="Request"?($("#competence-required, #competence-info-requirement, #competence-not-available").hide(),$("#competence-requested, #competence-info, #competence-prio-list").show()):$(n[0]).val()==="Requirement"?($("#competence-requested, #competence-info").hide(),$("#competence-required, #competence-prio-list, #competence-info-requirement").show(),o()):($("#competence-requested, #competence-required, #competence-prio-list, #competence-not-available, #competence-info-requirement").hide(),$("#competence-info").show())});$("body").on("change","input[name=CreatorIsInterpreterUser]",function(){a()});a();$("body").on("change","#SplitTimeRange_StartTimeHour",function(){var t=parseInt($(this).val()),i=$("#SplitTimeRange_EndTimeHour").val(),r=$("#SplitTimeRange_StartTimeMinutes").val(),u=$("#SplitTimeRange_EndTimeMinutes").val(),n;i===""&&(n=parseInt($(this).val())===23?0:t+1,$("#SplitTimeRange_EndTimeHour").val(n).trigger("change").trigger("select2:select"));r===""&&$("#SplitTimeRange_StartTimeMinutes").val(0).trigger("change").trigger("select2:select");u===""&&$("#SplitTimeRange_EndTimeMinutes").val(0).trigger("change").trigger("select2:select")});$("body").on("change","#SplitTimeRange_StartTimeHour, #SplitTimeRange_StartTimeMinutes, #SplitTimeRange_EndTimeHour, #SplitTimeRange_EndTimeMinutes",function(){u();b()});$("body").on("change","#LatestAnswerBy_Hour",function(){$("#LatestAnswerBy_Minute").val()===""&&$("#LatestAnswerBy_Minute").val(0).trigger("change").trigger("select2:select")});$("body").on("change","#SplitTimeRange_StartDate",function(){var t=new Date($("#now").val()),i,n;if(r||t.getHours()!==14||($("#LastTimeForRequiringLatestAnswerBy").val($("#NextLastTimeForRequiringLatestAnswerBy").val()),r=!0),i=new Date($("#LastTimeForRequiringLatestAnswerBy").val()),n=new Date($(this).val()),f=!0,n<=i){if($("#SeveralOccasions").is(":checked")){f=!1;return}$("#LatestAnswerBy").show();$("#LatestAnswerBy_Date").datepicker("setStartDate",t.zeroTime());$("#LatestAnswerBy_Date").datepicker("setEndDate",n);LastAnswerByIsShowing=!0}else $("#LatestAnswerBy").hide(),LastAnswerByIsShowing=!1;u()});$("body").on("click",".wizard-forward-button",function(){document.body.scrollTop=0;document.documentElement.scrollTop=0});$("body").on("click","input[name=AllowExceedingTravelCost]",function(){s("AllowExceedingTravelCost");$(this).val()==="YesShouldBeApproved"?($(".allow-more-travel-cost-information").show(),$(".allow-no-review-travel-cost-information").hide()):$(this).val()==="YesShouldNotBeApproved"?($(".allow-more-travel-cost-information").hide(),$(".allow-no-review-travel-cost-information").show()):($(".allow-more-travel-cost-information").hide(),$(".allow-no-review-travel-cost-information").hide())});$("body").on("click","tr > td > div > a.small-button.remove",function(){var t=$(".several-occasions-table table").DataTable();t.row($(this).parents("tr")).remove().draw();n=0;t.data().any()?$(".several-occasions-table table tbody tr").each(function(){$(this).find("input").each(function(){var t=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(t,n));$(this).prop("name",$(this).prop("name").replace(t,n))});n++}):($("#SeveralOccasions").prop("checked",!1).trigger("change"),u())});$("body").on("change","#SeveralOccasions",function(){if($(this).is(":checked"))$(".several-occasions-table").show(),$(".add-date-button-row").show(),l();else{$("#OccasionValidator").show();$("#OccasionValidator").empty();$(".several-occasions-table").hide();$(".add-date-button-row").hide();var t=$(".several-occasions-table table").DataTable();t.clear().draw();n=0;$("#SplitTimeRange_StartDate").val()!==""&&$("#SplitTimeRange_StartDate").trigger("change");u()}});$("body").on("click",".add-occasion",function(){l()});$(".allow-more-travel-cost").hide();$("input[name=CompetenceLevelDesireType]").trigger("change");$("#UseRankedInterpreterLocation").trigger("change");w();$("#SplitTimeRange_StartDate").trigger("change");$(".allow-no-review-travel-cost-information").hide();$(".allow-more-travel-cost-information").hide();$("#SeveralOccasions").trigger("change");$(".extra-interpreter-part").detach().appendTo(".date-and-time-part");$("#SeveralOccasions").prop("disabled",!0);var g=function(){var n,r;if(!$("#LatestAnswerBy_Date").is(":visible"))return!0;var t=new Date($("#LatestAnswerBy_Date").val()),i=$("#LatestAnswerBy_Hour").val(),u=$("#LatestAnswerBy_Minute").val();if(t!==""&&i!==""&&u!==""){if(n=new Date($("#now").val()),!t.equalsDate(n)&&t<n)return!1;if(t.equalsDate(n)){if(r=n.getHours(),r>Number(i))return!1;if(r===Number(i))return!(n.getMinutes()>Number(u))}}return!0},nt=function(){if(!$("#LatestAnswerBy_Date").is(":visible"))return!0;var n=new Date($("#LatestAnswerBy_Date").val()),t=$("#LatestAnswerBy_Hour").val(),i=$("#LatestAnswerBy_Minute").val();if(n!==""&&t!==""&&i!==""){var r=new Date($("#SplitTimeRange_StartDate").val()),u=$("#SplitTimeRange_StartTimeHour").val(),f=$("#SplitTimeRange_StartTimeMinutes").val();if(n>r)return!1;if(n.equalsDate(new Date(r))){if(Number(t)>Number(u))return!1;if(Number(t)===Number(u))return Number(f)>Number(i)}}return!0},tt=function(){var n=new Date($("#now").val());return!r&&n.getHours()===14&&!$("#LatestAnswerBy_Date").is(":visible")?($("#LastTimeForRequiringLatestAnswerBy").val($("#NextLastTimeForRequiringLatestAnswerBy").val()),r=!0,$("#LatestAnswerBy").show(),LastAnswerByIsShowing=!0,!1):!0},it=function(){var t=new Date($("#SplitTimeRange_StartDate").val()),i=$("#SplitTimeRange_StartTimeHour").val(),u=$("#SplitTimeRange_StartTimeMinutes").val(),n,r;if(t!==""&&i!==""&&u!==""){if(n=new Date($("#now").val()),!t.equalsDate(n)&&t<n)return!1;if(t.equalsDate(n)){if(r=n.getHours(),r>Number(i))return!1;if(r===Number(i))return!(n.getMinutes()>Number(u))}}return!0},rt=function(){var n=Number($("#SplitTimeRange_StartTimeHour").val()),t=Number($("#SplitTimeRange_StartTimeMinutes").val()),i=Number($("#SplitTimeRange_EndTimeHour").val()),r=Number($("#SplitTimeRange_EndTimeMinutes").val());return Number(n)===i?r!==Number(t):!0},ut=function(){return $("#CompetenceLevelDesireType").is(":hidden")||$("[name=CompetenceLevelDesireType]").filter(":checked").length>0},ft=function(){return $("[name=CreatorIsInterpreterUser]").filter(":checked").length>0},et=function(){if($("#AllowExceedingTravelCost").is(":hidden"))return!0;var n=$("[id^=AllowExceedingTravelCost_]").filter(":checked")[0];return n!==undefined};h=$(".wizard");h.tolkWizard({backHandler:function(){$("#send").tooltip("destroy")},nextHandler:function(n){var i=0,r,u,f,o;if($("[data-valmsg-for]").empty(),LastAnswerByIsShowing||($("#LatestAnswerBy_Date").val(""),$("#LatestAnswerBy_Hour").val("").trigger("change"),$("#LatestAnswerBy_Minute").val("").trigger("change")),ut()||(t("CompetenceLevelDesireType","Ange om kompetensnivå är krav eller önskemål"),i++),et()||(t("AllowExceedingTravelCost","Ange huruvida restid eller resväg som överskriver gränsvärden accepteras"),i++),ft()||(t("CreatorIsInterpreterUser","Ange om tolkanvändare är samma person som bokar"),i++),r=d(),r!==""&&(t("RequestedCompetenceLevelFirst",r),i++),$("#SeveralOccasions").is(":checked")){if(e()&&!confirm("Det finns ett fullständigt tillfälle som inte är tillagt än. Vill du fortsätta?"))return!1}else it()||(t("SplitTimeRange.EndTimeMinutes","Uppdraget har en starttid som redan har passerats, var god ändra detta."),i++),rt()||(t("SplitTimeRange.EndTimeMinutes","Uppdragets start- och sluttid har samma värde, var god ändra detta."),i++),g()||(t("LatestAnswerBy.Date","Sista svarstid har redan passerats, var god ändra detta."),i++),nt()||(t("LatestAnswerBy.Date","Sista svarstid kan inte vara senare än tolkuppdragets starttid, var god ändra detta."),i++),tt()||(t("LatestAnswerBy.Date","Sista svarstid måste nu anges."),i++);if(i!==0)return!1;u=h.closest("form");f=n.NextStep;$("#send").attr("disabled","disabled");$("#back").attr("disabled","disabled");n.IsLastPage?u.submit():(o=tolkBaseUrl+"Order/Confirm",$.ajax({url:o,type:"POST",data:u.serialize(),dataType:"html",success:function(n){$(".wizard .wizard-step").eq(f).html(n);$(".form-entry-information").tooltip();$("#send").removeAttr("disabled").tooltip({title:"Observera att det finns begränsade möjligheter att ändra bokningen efter att den skickats iväg. Om du är osäker på ifall det går att hitta en tolk som uppfyller ställda krav kan du istället ange dem som önskemål."});$("#back").removeAttr("disabled")},error:function(){$(".wizard .wizard-step").eq(f).html("Det går inte att avropa tolk vid detta tillfälle");$(".form-entry-information").tooltip();$("#back").removeAttr("disabled")}}))},wizardStepRendered:function(){$("#send").append('<span class="center-glyphicon glyphicon glyphicon-triangle-right"><\/span>');$("#send").blur()}});$("body").on("mousedown",".wizard-forward-button",function(){$("#SeveralOccasions").is(":checked")&&$(".order-datepicker input, .order-datepicker select").each(function(){$(this).addClass("ignore-validation")})});$("body").on("click",".wizard-forward-button",function(){$(".order-datepicker input, .order-datepicker select").each(function(){$(this).removeClass("ignore-validation")})})});