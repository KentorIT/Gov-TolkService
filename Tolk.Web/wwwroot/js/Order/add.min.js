var LastAnswerByIsShowing=!1;$(function(){function nt(t,i){var u=new Date($("#now").val());if(u-t==0||u>t)return"Tid och datum för tillfället har redan passerat.";var r="",e=$("#occasion-tbody"),f=e.find("tr");return f.length===1&&n===0?r:(f.each(function(){var n=$(this).find("input[name$='OccasionStartDateTime']").val(),u=$(this).find("input[name$='OccasionEndDateTime']").val();if(new Date(n)-i==0||new Date(u)-t==0||new Date(n)-t==0||new Date(u)-i==0){r="Detta tillfälle startar eller slutar samtidigt som ett tidigare tillagt tillfälle startar eller slutar. Det måste vara mellanrum mellan tillfällena.";return}if(new Date(n)>t&&new Date(n)<i||new Date(n)<t&&new Date(u)>t){r="Detta tillfälle överlappar med ett tidigare tillagt tillfälle.";return}}),r)}function tt(){if($("#LanguageId option:selected").attr("data-additional")!==""){var i=$("input[name = CompetenceLevelDesireType]").filter("input:checked"),n=$("#RequestedCompetenceLevelFirst").val(),t=$("#RequestedCompetenceLevelSecond").val();if($(i[0]).val()==="Requirement"){if(n==="")return"Krav i första hand måste anges";if(n===t)return"Krav i första och andra hand kan inte vara samma"}if($(i[0]).val()==="Request"){if(n===""&&n!==t)return"Ange önskemål i första hand om du angett önskemål i andra hand";if(n!==""&&n===t)return"Önskemål i första och andra hand kan inte vara samma"}}return""}function a(){var n=$("#LanguageId option:selected").attr("data-additional"),t=!1,i=$("input[name = CompetenceLevelDesireType]").filter("input:checked");$(i[0]).val()==="Requirement"&&n.length!==4&&$("#RequestedCompetenceLevelFirst, #RequestedCompetenceLevelSecond").each(function(){switch($(this).val()){case"CourtSpecialist":n.indexOf("L")>=0||(t=!0);break;case"HealthCareSpecialist":n.indexOf("H")>=0||(t=!0);break;case"AuthorizedInterpreter":n.indexOf("A")>=0||(t=!0);break;case"EducatedInterpreter":n.indexOf("E")>=0||(t=!0)}});t?$("#competence-not-available").show():$("#competence-not-available").hide()}function w(n){n.find("#RequirementDescription").val("");var t=n.find("form:first");n.bindEnterKey("form:first input",".btn-default");t.find(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error").html("")}function u(n,t){var i='[data-valmsg-for="'+n+'"]';$(i).empty();$(i).append(t);$(i).show()}function y(n,t){t.empty();t.append(n);t.show()}var i=0,r=0,n=0,h=!1,c=!0,b='<div class="pull-right"><a class="btn btn-warning small-button-row change">Ändra <span class="glyphicon glyphicon-edit"><\/span><\/a>&nbsp;<a class="btn btn-danger small-button remove">Ta bort <span class="btn-remove-times-small">&times;<\/span><\/a><\/div>',f=$("#req").parents(".modal-content"),e=$("#des").parents(".modal-content"),k=function(n){n.attr("value")===$("#OtherLanguageId").val()?$("#other-language").collapse("show"):$("#other-language").collapse("hide");n.attr("data-additional")===""?($(".competence-information > span.info-message-small").text("").removeAttr("role"),$("#divNonCompetenceLevel").show(),$("#divNonCompetenceLevel2").show(),$("#divCompetenceLevel").hide(),$("#LanguageHasAuthorizedInterpreter").val("false"),$(".competence-information").removeClass("d-none"),$(".competence-information").addClass("d-none"),$("#competence-not-available").hide()):(d(n.attr("data-additional")),$("#divNonCompetenceLevel").hide(),$("#divNonCompetenceLevel2").hide(),$("#divCompetenceLevel").show(),$("#LanguageHasAuthorizedInterpreter").val("true"),a())},d=function(n){$(".competence-information").removeClass("d-none");$(".competence-information > div.comp-list").find("li").remove();$(".competence-information > div.comp-list").find("ul").remove();n.length===4?($(".competence-information").removeClass("warning-info-home").removeClass("warning-info-yellow").addClass("system-action-info").children("span.glyphicon.message-icon").removeClass("glyphicon-exclamation-sign").addClass("glyphicon-ok").removeClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Det finns tolkar inom samtliga kompetensnivåer för valt språk i Kammarkollegiets tolkregister").attr("role","status")):n==="0"?($(".competence-information").removeClass("warning-info-yellow").removeClass("system-action-info").addClass("warning-info-home").children("span.glyphicon.message-icon").removeClass("glyphicon-ok").addClass("glyphicon-exclamation-sign").removeClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Det finns för närvarande inga tolkar som är utbildade eller auktoriserade i valt språk i Kammarkollegiets tolkregister").attr("role","alert")):($(".competence-information").removeClass("warning-info-home").removeClass("system-action-info").addClass("warning-info-yellow").children("span.glyphicon.message-icon").removeClass("glyphicon-ok").addClass("glyphicon-exclamation-sign").addClass("yellow-glyphicon"),$(".competence-information > span.info-message-small").text("Tolkar med följande kompetensnivå finns i Kammarkollegiets tolkregister för valt språk:").attr("role","alert"),$(".competence-information > div.comp-list").append("<ul>"),n.indexOf("L")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Rättstolk<\/li>"),n.indexOf("H")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Sjukvårdstolk<\/li>"),n.indexOf("A")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Auktoriserad tolk<\/li>"),n.indexOf("E")>=0&&$(".competence-information > div.comp-list").find("ul").append("<li>Utbildad tolk<\/li>"),$(".competence-information > div.comp-list").append("<\/ul>"))},o=function(n,t,i){n.val()==="Gender"?(t.show(),i.hide()):(t.hide(),i.show(),i.find("input").val(""))},p=function(){var e,u,o,h,i,a,f,r,v;if($("#OccasionValidator").empty(),!c){y("Det går inte att lägga till tillfällen för nära i tiden när man vill boka flera tillfällen.",$("#OccasionValidator"));return}if(!l()){y("Fyll i datum och tid",$("#OccasionValidator"));return}if(e=getDate($("#SplitTimeRange_StartDate").val(),$("#SplitTimeRange_StartTimeHour").val(),$("#SplitTimeRange_StartTimeMinutes").val()),u=getDate($("#SplitTimeRange_StartDate").val(),$("#SplitTimeRange_EndTimeHour").val(),$("#SplitTimeRange_EndTimeMinutes").val()),u<e&&u.addDays(1),o=nt(e,u),o!==""){y(o,$("#OccasionValidator"));return}var p=$(".order-datepicker").closest("form"),w=p.validate(),s=!0;($(".order-datepicker input, .order-datepicker select").each(function(n,t){s=w.element(t)&&s}),s)&&(h=$("#ExtraInterpreter").is(":checked")?"Ja":"Nej",i=$("#baseOccasion").clone(),i.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",n));$(this).prop("name",$(this).prop("name").replace("0",n))}),n++,a=$("#SplitTimeRange_StartDate").val()+" "+t($("#SplitTimeRange_StartTimeHour").val())+":"+t($("#SplitTimeRange_StartTimeMinutes").val())+"-"+t($("#SplitTimeRange_EndTimeHour").val())+":"+t($("#SplitTimeRange_EndTimeMinutes").val()),f=new Date($("#SplitTimeRange_StartDate").val()),f.setHours($("#SplitTimeRange_StartTimeHour").val()),f.setMinutes($("#SplitTimeRange_StartTimeMinutes").val()),i.find("input[name$='OccasionStartDateTime']").val($("#SplitTimeRange_StartDate").val()+" "+t($("#SplitTimeRange_StartTimeHour").val())+":"+t($("#SplitTimeRange_StartTimeMinutes").val())),r=new Date($("#SplitTimeRange_StartDate").val()),r.setHours($("#SplitTimeRange_EndTimeHour").val()),r.setMinutes($("#SplitTimeRange_EndTimeMinutes").val()),r<=f&&r.addDays(1),i.find("input[name$='OccasionEndDateTime']").val(r.toLocaleDateString("sv-SE").replace(/&lrm;|\u200E/gi,"")+" "+t($("#SplitTimeRange_EndTimeHour").val())+":"+t($("#SplitTimeRange_EndTimeMinutes").val())),i.find("input[name$='ExtraInterpreter']").val($("#ExtraInterpreter").is(":checked")?"true":"false"),v=$(".several-occasions-table table").DataTable(),v.row.add([a+i.html(),h,b]).draw(),$(".order-datepicker input:text").val(""),$(".order-datepicker select").each(function(){$(this).val("").trigger("change")}),$("#ExtraInterpreter").prop("checked",!1))},t=function(n){return n<10?"0"+n:""+n},g=function(){var n=new Date($("#now").val());h=!(n.getHours()===13||n.getHours()===23)},s=function(){if(!$("#SeveralOccasions").is(":checked")){var n=LastAnswerByIsShowing||!l();$("#SeveralOccasions").prop("disabled",n);n?$("#SeveralOccasions").parents(".checkbox").addClass("checkbox-disabled"):$("#SeveralOccasions").parents(".checkbox").removeClass("checkbox-disabled")}},l=function(){return!($("#SplitTimeRange_StartDate").val()===""||$("#SplitTimeRange_StartTimeHour").val()===""||$("#SplitTimeRange_StartTimeMinutes").val()===""||$("#SplitTimeRange_EndTimeHour").val()===""||$("#SplitTimeRange_EndTimeMinutes").val()==="")},v;$("body").on("click",".remove-requirement-row",function(){var t=$(this).closest("tbody"),n;$(this).closest("tr").remove();n=t.find("tr");i=0;n.length===0?$(".order-requirement-list").addClass("d-none"):n.each(function(){$(this).find("input").each(function(){var n=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(n,i));$(this).prop("name",$(this).prop("name").replace(n,i))});i++})});$("body").on("click",".remove-desiredRequirement-row",function(){var t=$(this).closest("tbody"),n;$(this).closest("tr").remove();n=t.find("tr");r=0;n.length===0?$(".order-desiredRequirement-list").addClass("d-none"):n.each(function(){$(this).find("input").each(function(){var n=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(n,r));$(this).prop("name",$(this).prop("name").replace(n,r))});r++})});$("body").on("click",".add-requirement-button",function(){var n=$($(this).data("target"));w(n);o(n.find("#RequirementType"),n.find("input[name$=Gender]").parents(".form-group"),n.find("#RequirementDescription").parents(".form-group"))});$("body").on("click",".add-desiredRequirement-button",function(){var n=$($(this).data("target"));w(n);o(n.find("#DesiredRequirementType"),n.find("input[name$=DesiredGender]").parents(".form-group"),n.find("#DesiredRequirementDescription").parents(".form-group"))});$("body").on("click",".save-requirement",function(n){var t,u,r;n.preventDefault();t=$(this).parents(".modal-content");t.find("#RequirementType option:selected").text()==="Tolkens kön"&&(u=t.find("input[type='Radio']").filter(":checked").val()==="Female"?"Kvinna":"Man",t.find("#RequirementDescription").val(u));t.find("form").valid()&&(r=$("#baseRequirement").clone(),r.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",i));$(this).prop("name",$(this).prop("name").replace("0",i))}),i++,t.find("input:not(:checkbox), select, textarea").each(function(){r.find("input[name$='"+$(this).prop("id")+"']").val($(this).val())}),t.find("input:checkbox").each(function(){r.find("input[name$='"+$(this).prop("id")+"']").val($(this).is(":checked")?"true":"false")}),$(".order-requirement-table > tbody:last-child").append('<tr><td class="table-type-column">'+r.html()+$("#RequirementType option:selected").text()+'<\/td><td class="table-description-column">'+$("#RequirementDescription").val()+'<\/td><td class="table-button-column fixed"><span class="remove-requirement-row bold">&times;<\/span><\/td><\/tr>'),$(".order-requirement-list").removeClass("d-none"),$("#addRequirement").modal("hide"))});$("body").on("click",".save-desiredRequirement",function(n){var t,u,i;n.preventDefault();t=$(this).parents(".modal-content");t.find("#DesiredRequirementType option:selected").text()==="Tolkens kön"&&(u=t.find("input[type='Radio']").filter(":checked").val()==="Female"?"Kvinna":"Man",t.find("#DesiredRequirementDescription").val(u));t.find("form").valid()&&(i=$("#baseDesiredRequirement").clone(),i.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",r));$(this).prop("name",$(this).prop("name").replace("0",r))}),r++,t.find("input:not(:checkbox), select, textarea").each(function(){i.find("input[name$='"+$(this).prop("id")+"']").val($(this).val())}),t.find("input:checkbox").each(function(){i.find("input[name$='"+$(this).prop("id")+"']").val($(this).is(":checked")?"true":"false")}),$(".order-desiredRequirement-table > tbody:last-child").append('<tr><td class="table-type-column">'+i.html()+$(this).parents(".modal-content").find("#DesiredRequirementType option:selected").text()+'<\/td><td class="table-description-column">'+$(this).parents(".modal-content").find("#DesiredRequirementDescription").val()+'<\/td><td class="table-button-column fixed"><span class="remove-desiredRequirement-row bold">&times;<\/span><\/td><\/tr>'),$(".order-desiredRequirement-list").removeClass("d-none"),$("#addDesiredRequirement").modal("hide"))});f.find("#RequirementType").on("change",function(){o(f.find("#RequirementType"),f.find("input[name$=Gender]").parents(".form-group"),f.find("#RequirementDescription").parents(".form-group"))});e.find("#DesiredRequirementType").on("change",function(){o(e.find("#DesiredRequirementType"),e.find("input[name$=DesiredGender]").parents(".form-group"),e.find("#DesiredRequirementDescription").parents(".form-group"))});$("body").on("change","#LanguageId",function(){k($("#LanguageId option:selected"))});$("body").on("change","#RequestedCompetenceLevelFirst, #RequestedCompetenceLevelSecond",function(){a()});$("body").on("change","input[name=CompetenceLevelDesireType]",function(){var n=$(this).filter("input:checked");$(n[0]).val()==="Request"?($("#competence-required, #competence-info-requirement, #competence-not-available").hide(),$("#competence-requested, #competence-info, #competence-prio-list").show()):$(n[0]).val()==="Requirement"?($("#competence-requested, #competence-info").hide(),$("#competence-required, #competence-prio-list, #competence-info-requirement").show(),a()):($("#competence-requested, #competence-required, #competence-prio-list, #competence-not-available, #competence-info-requirement").hide(),$("#competence-info").show())});$("body").on("change","#SplitTimeRange_StartTimeHour",function(){var t=parseInt($(this).val()),i=$("#SplitTimeRange_EndTimeHour").val(),r=$("#SplitTimeRange_StartTimeMinutes").val(),u=$("#SplitTimeRange_EndTimeMinutes").val(),n;i===""&&(n=parseInt($(this).val())===23?0:t+1,$("#SplitTimeRange_EndTimeHour").val(n).trigger("change").trigger("select2:select"));r===""&&$("#SplitTimeRange_StartTimeMinutes").val(0).trigger("change").trigger("select2:select");u===""&&$("#SplitTimeRange_EndTimeMinutes").val(0).trigger("change").trigger("select2:select")});$("body").on("change","#SplitTimeRange_StartTimeHour, #SplitTimeRange_StartTimeMinutes, #SplitTimeRange_EndTimeHour, #SplitTimeRange_EndTimeMinutes",function(){s()});$("body").on("change","#LatestAnswerBy_Hour",function(){$("#LatestAnswerBy_Minute").val()===""&&$("#LatestAnswerBy_Minute").val(0).trigger("change").trigger("select2:select")});$("body").on("change","#SplitTimeRange_StartDate",function(){var n=new Date($("#now").val()),i,t;if(h||n.getHours()!==14&&n.getHours()!==0||($("#LastTimeForRequiringLatestAnswerBy").val($("#NextLastTimeForRequiringLatestAnswerBy").val()),h=!0),i=new Date($("#LastTimeForRequiringLatestAnswerBy").val()),t=new Date($(this).val()),c=!0,t<=i){if($("#SeveralOccasions").is(":checked")){c=!1;return}$("#LatestAnswerBy").show();$("#LatestAnswerBy_Date").datepicker("setStartDate",n.zeroTime());$("#LatestAnswerBy_Date").datepicker("setEndDate",t);LastAnswerByIsShowing=!0}else $("#LatestAnswerBy").hide(),LastAnswerByIsShowing=!1;s()});$("body").on("change",".location-group",function(){var n=!1;$("select[id^=RankedInterpreterLocation]").each(function(){switch($(this).val()){case"OnSite":case"OffSiteDesignatedLocation":n=!0}});n?$(".allow-more-travel-cost").show():$(".allow-more-travel-cost").hide()});$("body").on("click",".wizard-forward-button",function(){document.body.scrollTop=0;document.documentElement.scrollTop=0});$("body").on("click","input[name=AllowExceedingTravelCost]",function(){$(this).val()==="YesShouldBeApproved"?($(".allow-more-travel-cost-information").show(),$(".allow-no-review-travel-cost-information").hide()):$(this).val()==="YesShouldNotBeApproved"?($(".allow-more-travel-cost-information").hide(),$(".allow-no-review-travel-cost-information").show()):($(".allow-more-travel-cost-information").hide(),$(".allow-no-review-travel-cost-information").hide())});$("body").on("click","tr > td > div > a.small-button-row.change",function(){alert("add functionality for taking the info in the row reading into the occasion input above the row...")});$("body").on("click","tr > td > div > a.small-button.remove",function(){var t=$(".several-occasions-table table").DataTable();t.row($(this).parents("tr")).remove().draw();n=0;t.data().any()?$(".several-occasions-table table tbody tr").each(function(){$(this).find("input").each(function(){var t=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(t,n));$(this).prop("name",$(this).prop("name").replace(t,n))});n++}):($("#SeveralOccasions").prop("checked",!1).trigger("change"),s())});$("body").on("change","#SeveralOccasions",function(){if($(this).is(":checked"))$(".several-occasions-table").show(),$(".add-date-button-row").show(),p();else{$("#OccasionValidator").show();$("#OccasionValidator").empty();$(".several-occasions-table").hide();$(".add-date-button-row").hide();var t=$(".several-occasions-table table").DataTable();t.clear().draw();n=0;$("#SplitTimeRange_StartDate").val()!==""&&$("#SplitTimeRange_StartDate").trigger("change");s()}});$("body").on("click",".add-occasion",function(){p()});$(".allow-more-travel-cost").hide();$("input[name=CompetenceLevelDesireType]").trigger("change");$("#UseRankedInterpreterLocation").trigger("change");g();$("#SplitTimeRange_StartDate").trigger("change");$(".allow-no-review-travel-cost-information").hide();$(".allow-more-travel-cost-information").hide();$("#SeveralOccasions").trigger("change");$(".extra-interpreter-part").detach().appendTo(".date-and-time-part");$("#SeveralOccasions").prop("disabled",!0);var it=function(){var n,i;if(!$("#LatestAnswerBy_Date").is(":visible"))return!0;var r=new Date($("#LatestAnswerBy_Date").val()),t=$("#LatestAnswerBy_Hour").val(),u=$("#LatestAnswerBy_Minute").val();if(r!==""&&t!==""&&u!==""&&(n=new Date($("#now").val()),r.equalsDate(n))){if(i=n.getHours(),i>Number(t))return!1;if(i===Number(t))return!(n.getMinutes()>Number(u))}return!0},rt=function(){if(!$("#LatestAnswerBy_Date").is(":visible"))return!0;var t=new Date($("#LatestAnswerBy_Date").val()),n=$("#LatestAnswerBy_Hour").val(),i=$("#LatestAnswerBy_Minute").val();if(t!==""&&n!==""&&i!==""){var u=new Date($("#SplitTimeRange_StartDate").val()),r=$("#SplitTimeRange_StartTimeHour").val(),f=$("#SplitTimeRange_StartTimeMinutes").val();if(t.equalsDate(new Date(u))){if(Number(n)>Number(r))return!1;if(Number(n)===Number(r))return Number(f)>Number(i)}}return!0},ut=function(){var r=new Date($("#SplitTimeRange_StartDate").val()),t=$("#SplitTimeRange_StartTimeHour").val(),u=$("#SplitTimeRange_StartTimeMinutes").val(),n,i;if(r!==""&&t!==""&&u!==""&&(n=new Date($("#now").val()),r.equalsDate(n))){if(i=n.getHours(),i>Number(t))return!1;if(i===Number(t))return!(n.getMinutes()>Number(u))}return!0},ft=function(){var n=Number($("#SplitTimeRange_StartTimeHour").val()),t=Number($("#SplitTimeRange_StartTimeMinutes").val()),i=Number($("#SplitTimeRange_EndTimeHour").val()),r=Number($("#SplitTimeRange_EndTimeMinutes").val());return Number(n)===i?r!==Number(t):!0},et=function(){return $("#CompetenceLevelDesireType").is(":hidden")||$("[name=CompetenceLevelDesireType]").filter(":checked").length>0},ot=function(){if($("#AllowExceedingTravelCost").is(":hidden"))return!0;var n=$("[id^=AllowExceedingTravelCost_]").filter(":checked")[0];return n!==undefined};v=$(".wizard");v.tolkWizard({backHandler:function(){$("#send").tooltip("destroy")},nextHandler:function(n){var t=0,i,r,f,e;if($("[data-valmsg-for]").empty(),LastAnswerByIsShowing||($("#LatestAnswerBy_Date").val(""),$("#LatestAnswerBy_Hour").val("").trigger("change"),$("#LatestAnswerBy_Minute").val("").trigger("change")),et()||(u("CompetenceLevelDesireType","Ange om kompetensnivå är krav eller önskemål"),t++),ot()||(u("AllowExceedingTravelCost","Ange huruvida restid eller resväg som överskriver gränsvärden accepteras"),t++),i=tt(),i!==""&&(u("RequestedCompetenceLevelFirst",i),t++),$("#SeveralOccasions").is(":checked")){if(l()&&!confirm("Det finns ett fullständigt tillfälle som inte är tillagt än. Vill du fortsätta?"))return!1}else ut()||(u("SplitTimeRange.EndTimeMinutes","Uppdraget har en starttid som redan har passerats, var god ändra detta."),t++),ft()||(u("SplitTimeRange.EndTimeMinutes","Uppdragets start- och sluttid har samma värde, var god ändra detta."),t++),it()||(u("LatestAnswerBy.Date","Sista svarstid har redan passerats, var god ändra detta."),t++),rt()||(u("LatestAnswerBy.Date","Sista svarstid kan inte vara senare än tolkuppdragets starttid, var god ändra detta."),t++);if(t!==0)return!1;r=v.closest("form");f=n.NextStep;$("#send").attr("disabled","disabled");$("#back").attr("disabled","disabled");n.IsLastPage?r.submit():(e=tolkBaseUrl+"Order/Confirm",$.ajax({url:e,type:"POST",data:r.serialize(),dataType:"html",success:function(n){$(".wizard .wizard-step").eq(f).html(n);$(".form-entry-information").tooltip();$("#send").removeAttr("disabled").tooltip({title:"Observera att bokningen inte kan eller får ändras efter att den skickats iväg. Om du är osäker på ifall det går att hitta en tolk som uppfyller ställda krav kan du istället ange dem som önskemål"});$("#back").removeAttr("disabled")},error:function(n){alert(n)}}))},wizardStepRendered:function(){$("#send").append('<span class="center-glyphicon glyphicon glyphicon-triangle-right"><\/span>');$("#send").blur()}});$("body").on("mousedown",".wizard-forward-button",function(){$("#SeveralOccasions").is(":checked")&&$(".order-datepicker input, .order-datepicker select").each(function(){$(this).addClass("ignore-validation")})});$("body").on("click",".wizard-forward-button",function(){$(".order-datepicker input, .order-datepicker select").each(function(){$(this).removeClass("ignore-validation")})})});