$(function(){var n=0;$("body").on("click",".remove-file-row",function(){var i=$(this).closest("tbody"),r=$(this).closest("tr"),u=tolkBaseUrl+"Files/Delete?id="+r.data("id")+"&groupKey="+$("#FileGroupKey").val(),t;$.ajax({url:u,type:"DELETE",dataType:"json",success:function(n){n.success||alert(n.ErrorMessage,"Något gick fel när filen skulle tas bort!")}});r.remove();t=i.find("tr");n=0;t.length===0?i.closest(".file-list").addClass("d-none"):t.each(function(){$(this).find("input").each(function(){var t=$(this).prop("id").match(/\d+/);$(this).prop("id",$(this).prop("id").replace(t,n));$(this).prop("name",$(this).prop("name").replace(t,n))});n++})});$("body").on("click",".file-table-view > tbody > tr > td:not(.table-button-column)",function(){var n=$(this).closest("tr");window.open(tolkBaseUrl+"Files/Download?id="+n.data("id"))});$("body").on("click","#addFilesDialog",function(){$("#choose-file").text("Välj fil")});$("body").on("click","#addFilesDialog .upload-files",function(t){var i,r,f,u;if(t.preventDefault(),i=$(this).closest("form"),i.valid()){for(r=0,$(".file-table-add > tbody > tr").each(function(){r+=$(this).data("size")}),f=i.find("input[type=file]")[0].files,u=0;u<f.length;++u)r+=f[u].size;if(r>$("#CombinedMaxSizeAttachments").val()){alert("Den gemensamma storleken på alla bifogade filer överstiger "+$("#CombinedMaxSizeAttachments").val()/1048576+"MB");return}$.ajax({url:i[0].action,type:"POST",data:new FormData(i[0]),processData:!1,contentType:!1,success:function(t){var i,r;if(t.success){for(i=0;i<t.fileInfo.length;++i)r=$("#basefile").clone(),r.find("input").each(function(){$(this).prop("id",$(this).prop("id").replace("0",n));$(this).prop("name",$(this).prop("name").replace("0",n))}),n++,r.find("input").val(t.fileInfo[i].id),$(".file-table-add > tbody:last-child").append('<tr data-id="'+t.fileInfo[i].id+'" data-size="'+t.fileInfo[i].size+'"><td class="table-full-column"> <span class="glyphicon glyphicon-paperclip"><\/span>'+r.html()+t.fileInfo[i].fileName+'<\/td><td class="table-button-column fixed"><span class="remove-file-row bold">&times;<\/span><\/td><\/tr>'),$(".file-list").removeClass("d-none");$("#FileGroupKey").val(t.groupKey);$("#GroupKey").val(t.groupKey);$("#addFilesDialog").modal("hide")}else alert(t.errorMessage,"Problem vid uppladdning")}})}});n=$(".file-table-add > tbody > tr").length});$("body").on("change",".filestyle",function(){var t=$(".filestyle")[0].files,i,n;if(t.length>0)for(i="",$("#choose-file").text("Ändra fil"),n=0;n<t.length;n++)i+=n>0?", "+t[n].name:" "+t[n].name;$("#selected-filename").text(i)});